---
layout: post
title: 'CVE-2019-17555: DoS via Retry-After header in Apache Olingo'
date: 2019-12-13 22:42:07.000000000 +00:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Security
tags:
- Apache
- CVE
- DoS
- Java
- Olingo
- Security
- Vulnerability
meta:
  _edit_last: '1'
  _yoast_wpseo_primary_category: '157'
  _yoast_wpseo_content_score: '90'
  _yoast_wpseo_focuskw: CVE-2019-17555
  _yoast_wpseo_metadesc: The post descibes a little vulnerability CVE-2019-17555 in
    Apache Olingo which may help to implement a denial-of-service attack.
  _yoast_wpseo_linkdex: '63'
  rp4wp_auto_linked: '1'
  _wpdiscuz_statistics: a:4:{s:7:"threads";i:0;s:7:"replies";i:0;s:7:"authors";i:0;s:14:"recent_authors";a:0:{}}
  _oembed_57d72e6511eab5903ae5be60bb95cd38: <a class="twitter-timeline" data-width="625"
    data-height="938" data-dnt="true" href="https://twitter.com/artem_smotrakov?ref_src=twsrc%5Etfw">Tweets
    by artem_smotrakov</a><script async src="https://platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_time_57d72e6511eab5903ae5be60bb95cd38: '1617981885'
author:
  login: artem
  email: artem.smotrakov@gmail.com
  display_name: Artem
  first_name: Artem
  last_name: Smotrakov
permalink: "/en/security/cve-2019-17555-dos-via-retry-after-header-in-apache-olingo.html"
---
<!-- wp:paragraph -->

Apache Olingo is a Java library that implements the Open Data Protocol (OData). This protocol allows the creation and consumption of queryable and interoperable RESTful APIs in a simple way.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

This post describes a little vulnerability that I recently discovered in Apache Olingo. The issue has been fixed in the 4.7.0 release.

<!-- /wp:paragraph -->

<!-- wp:image {"id":3674,"sizeSlug":"large","className":"noborder"} -->

![CVE-2019-17555: DoS via Retry-After header in Apache Olingo]({{ site.baseurl }}/assets/images/2019/12/cowsay-no-long-sleep-for-apache-olingo.jpg)

<!-- /wp:image -->

<!-- wp:more -->  
<!--more-->  
<!-- /wp:more -->

<!-- wp:heading -->

## The issue

<!-- /wp:heading -->

<!-- wp:paragraph -->

OData protocol runs over HTTP. Apache Olingo implements an OData client. In particular, it offers the `AsyncRequestWrapperImpl` class which sends a request to an OData server and then handles a response. When a client asks a server to create a new record, the server may not be able to create a record immediately. In this case, the server may reply with a 202 status code and include the following HTTP headers into the response:

<!-- /wp:paragraph -->

<!-- wp:list -->

- `Location` header with a URL to a monitor which the client can check to see if the record is ready.
- `Retry-After` header with a number of seconds which the client should wait before checking the monitor.

<!-- /wp:list -->

<!-- wp:paragraph -->

After sending a request, the `AsyncRequestWrapperImpl` class pass a received response to the `AsyncResponseWrapperImpl`. If the response contains the 202 status code, then the `AsyncResponseWrapperImpl` class starts checking the monitor. If the monitor returns the 202 code, then the class waits for the number of seconds which it got from the `Retry-After` header. [Here](https://github.com/apache/olingo-odata4/blob/4.6.0/lib/client-core/src/main/java/org/apache/olingo/client/core/communication/request/AsyncRequestWrapperImpl.java) is what it looked like:

<!-- /wp:paragraph -->

<!-- wp:code {"className":"console"} -->

```
@Override
public R getODataResponse() {
  HttpResponse res = null;
  for (int i = 0; response == null && i < MAX_RETRY; i++) {
    res = checkMonitor(location);

    if (res.getStatusLine().getStatusCode() == HttpStatusCode.ACCEPTED.getStatusCode()) {
      final Header[] headers = res.getHeaders(HttpHeader.RETRY_AFTER);
      if (ArrayUtils.isNotEmpty(headers)) {
        this.retryAfter = Integer.parseInt(headers[0].getValue());
      }

      try {
        // wait for retry-after
        Thread.sleep((long)retryAfter * 1000);
      } catch (InterruptedException ignore) {
        // ignore
      }
```

<!-- /wp:code -->

<!-- wp:paragraph -->

The problem here is that the header value goes directly to the `Thread.sleep()` method. A malicious server can return a huge value in the `Retry-After` header which makes the client's thread sleep for a long time. It may help to implement a denial-of-service attack, however, it may be difficult for an attacker to trick the client to talk to the malicious server.

<!-- /wp:paragraph -->

<!-- wp:heading -->

## The solution

<!-- /wp:heading -->

<!-- wp:paragraph -->

The issue has been [fixed](https://github.com/apache/olingo-odata4/pull/61/files) by checking if the `Retry-After` header doesn't exceed the maximum allowed value. If the header is greater than the maximum allowed value, then the default delay is used.

<!-- /wp:paragraph -->

<!-- wp:heading -->

## Conclusion

<!-- /wp:heading -->

<!-- wp:paragraph -->

The issue doesn't look serious because it may be difficult to exploit it. Nevertheless, it may be better to update Apache Olingo to 4.7.0 to stay on the safe side.

<!-- /wp:paragraph -->

<!-- wp:heading -->

## References

<!-- /wp:heading -->

<!-- wp:list -->

- [CVE-2019-17555](https://nvd.nist.gov/vuln/detail/CVE-2019-17555)
- [Apache security advisory](https://mail-archives.apache.org/mod_mbox/olingo-user/201912.mbox/%3CCAGSZ4d65UmudJ_MQkFXEv9YY_wwZbRA3sgtNDzMoLM51Qh%3DRCA%40mail.gmail.com%3E)
- [Patch](https://github.com/apache/olingo-odata4/pull/61)
- [Apache Olingo](https://olingo.apache.org/)

<!-- /wp:list -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

